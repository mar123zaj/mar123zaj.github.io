---
import { Sun, Moon } from "@lucide/astro";
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Toggle dark mode"
  class="p-2 rounded-lg cursor-pointer text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
>
  <Sun id="icon-sun" class="hidden" size={20} />
  <Moon id="icon-moon" class="hidden" size={20} />
</button>

<script is:inline>
  function applyTheme() {
    const stored = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const isDark = stored === "dark" || (!stored && prefersDark);
    document.documentElement.classList.toggle("dark", isDark);
    document.getElementById("icon-sun")?.classList.toggle("hidden", !isDark);
    document.getElementById("icon-moon")?.classList.toggle("hidden", isDark);
  }

  applyTheme();

  document.getElementById("theme-toggle")?.addEventListener("click", () => {
    const isDark = document.documentElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
    document.getElementById("icon-sun")?.classList.toggle("hidden", !isDark);
    document.getElementById("icon-moon")?.classList.toggle("hidden", isDark);
  });
</script>
